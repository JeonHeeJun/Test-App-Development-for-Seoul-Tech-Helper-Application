{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\heejun\\\\test0220\\\\screens\\\\AccountScreen.js\";\nimport React from 'react';\nimport { AuthContext, UserContext, IdContext } from \"../components/context\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport ActivityIndicator from \"react-native-web/dist/exports/ActivityIndicator\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport Switch from \"react-native-web/dist/exports/Switch\";\nimport SwitchSelector from 'react-native-switch-selector';\nimport { SEE_REGIST_LECTURE } from \"../queries\";\nimport { ApolloClient, InMemoryCache, useQuery, ApolloProvider } from \"@apollo/client\";\nimport * as FileSystem from 'expo-file-system';\nimport * as Sharing from 'expo-sharing';\nimport * as Notifications from 'expo-notifications';\nimport AsyncStorage from '@react-native-community/async-storage';\nvar ICSname = \"학교생활도우미 일정\";\nvar NOW = new Date();\nvar TIMEZONE = NOW.getTimezoneOffset() * 60000;\nvar options = [{\n  label: '끄기',\n  value: 0\n}, {\n  label: '5분',\n  value: 5\n}, {\n  label: '10분',\n  value: 10\n}, {\n  label: '15분',\n  value: 15\n}, {\n  label: '20분',\n  value: 20\n}, {\n  label: '30분',\n  value: 30\n}, {\n  label: '60분',\n  value: 60\n}];\n\nfunction convertToICSDate(dateTime) {\n  var year = dateTime.getFullYear().toString();\n  var month = dateTime.getMonth() + 1 < 10 ? \"0\" + (dateTime.getMonth() + 1).toString() : (dateTime.getMonth() + 1).toString();\n  var day = dateTime.getDate() < 10 ? \"0\" + dateTime.getDate().toString() : dateTime.getDate().toString();\n  var hours = dateTime.getHours() < 10 ? \"0\" + dateTime.getHours().toString() : dateTime.getHours().toString();\n  var minutes = dateTime.getMinutes() < 10 ? \"0\" + dateTime.getMinutes().toString() : dateTime.getMinutes().toString();\n  return year + month + day + \"T\" + hours + minutes + \"00Z\";\n}\n\nfunction createVEVENT(start, end) {\n  var summary = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : \"\";\n  var description = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : \"\";\n  var location = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : \"\";\n  return \"BEGIN:VEVENT\\nDTSTART:\" + convertToICSDate(start) + \"\\nDTEND:\" + convertToICSDate(end) + \"\\nDESCRIPTION:\" + description + \"\\nLOCATION:\" + location + \"\\nSUMMARY:\" + summary + \"\\nEND:VEVENT\\n\";\n}\n\nfunction createCAL(class_list) {\n  var template = \"BEGIN:VCALENDAR\\nPRODID:-//Google Inc//Google Calendar 70.9054//EN\\nVERSION:2.0\\nCALSCALE:GREGORIAN\\nMETHOD:PUBLISH\\nX-WR-CALNAME:\" + ICSname + \"\\nX-WR-TIMEZONE:Asia/Seoul\\nBEGIN:VTIMEZONE\\nTZID:Asia/Seoul\\nX-LIC-LOCATION:Asia/Seoul\\nBEGIN:STANDARD\\nTZOFFSETFROM:+0900\\nTZOFFSETTO:+0900\\nTZNAME:KST\\nDTSTART:19700101T000000\\nEND:STANDARD\\nEND:VTIMEZONE\\n\";\n\n  for (var i = 0; i < class_list.length; i++) {\n    template += createVEVENT(class_list[i].start_time, class_list[i].end_time, class_list[i].name, class_list[i].name, class_list[i].room);\n  }\n\n  template += \"END:VCALENDAR\";\n  return template;\n}\n\nfunction Sub(_ref) {\n  var class_list = _ref.class_list;\n  var user = React.useContext(UserContext);\n  var user_meta = React.useContext(IdContext);\n\n  var _React$useContext = React.useContext(AuthContext),\n      signOut = _React$useContext.signOut;\n\n  var _React$useState = React.useState(true),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      notif_switch = _React$useState2[0],\n      setNotifSwitch = _React$useState2[1];\n\n  console.log(\"notif_switch:\", notif_switch);\n  AsyncStorage.getItem(\"notif_switch\", function (err, res) {\n    console.log(\"notif_switch res:\", res);\n    res == \"ON\" ? setNotifSwitch(true) : setNotifSwitch(false);\n  });\n\n  var notif_switch_handler = function notif_switch_handler() {\n    return _regeneratorRuntime.async(function notif_switch_handler$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!notif_switch) {\n              _context.next = 5;\n              break;\n            }\n\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"notif_switch\", \"OFF\"));\n\n          case 3:\n            _context.next = 7;\n            break;\n\n          case 5:\n            _context.next = 7;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"notif_switch\", \"ON\"));\n\n          case 7:\n            setNotifSwitch(!notif_switch);\n\n          case 8:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var exportICS = function exportICS() {\n    var uri = FileSystem.documentDirectory + \"schedule.ics\";\n    var file = createCAL(class_list);\n    FileSystem.writeAsStringAsync(uri, file).then(function () {\n      Sharing.shareAsync(uri);\n    }).catch(function (error) {\n      console.log(error);\n    });\n  };\n\n  var _React$useState3 = React.useState(null),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      pushInit = _React$useState4[0],\n      setPushInit = _React$useState4[1];\n\n  AsyncStorage.getItem(\"pushInitIndex\", function (err, res) {\n    console.log(\"pushInitIndex res:\", res);\n    setPushInit(Number(res));\n  });\n\n  var setNotification = function setNotification(val) {\n    var initIndex, i, trigger, month, date, sH, sM, eH, eM, start_time, end_time, id;\n    return _regeneratorRuntime.async(function setNotification$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            console.log(\"setNotification()\");\n            initIndex = \"0\";\n            _context2.t0 = val;\n            _context2.next = _context2.t0 === 5 ? 5 : _context2.t0 === 10 ? 7 : _context2.t0 === 15 ? 9 : _context2.t0 === 20 ? 11 : _context2.t0 === 30 ? 13 : _context2.t0 === 60 ? 15 : 17;\n            break;\n\n          case 5:\n            initIndex = \"1\";\n            return _context2.abrupt(\"break\", 18);\n\n          case 7:\n            initIndex = \"2\";\n            return _context2.abrupt(\"break\", 18);\n\n          case 9:\n            initIndex = \"3\";\n            return _context2.abrupt(\"break\", 18);\n\n          case 11:\n            initIndex = \"4\";\n            return _context2.abrupt(\"break\", 18);\n\n          case 13:\n            initIndex = \"5\";\n            return _context2.abrupt(\"break\", 18);\n\n          case 15:\n            initIndex = \"6\";\n            return _context2.abrupt(\"break\", 18);\n\n          case 17:\n            initIndex = \"0\";\n\n          case 18:\n            AsyncStorage.setItem(\"pushInitIndex\", initIndex, function () {\n              console.log(\"pushInitIndex set: \" + initIndex);\n            });\n            _context2.next = 21;\n            return _regeneratorRuntime.awrap(Notifications.cancelAllScheduledNotificationsAsync());\n\n          case 21:\n            if (!(val > 0)) {\n              _context2.next = 41;\n              break;\n            }\n\n            i = 0;\n\n          case 23:\n            if (!(i < class_list.length)) {\n              _context2.next = 41;\n              break;\n            }\n\n            if (!(class_list[i].start_time < NOW)) {\n              _context2.next = 26;\n              break;\n            }\n\n            return _context2.abrupt(\"continue\", 38);\n\n          case 26:\n            trigger = new Date(class_list[i].start_time.getTime() - val * 60 * 1000);\n            month = class_list[i].start_time.getMonth() + 1;\n            date = class_list[i].start_time.getDate();\n            sH = class_list[i].start_time.getHours();\n            sM = class_list[i].start_time.getMinutes();\n            eH = class_list[i].end_time.getHours();\n            eM = class_list[i].end_time.getMinutes();\n            start_time = (sH >= 10 ? sH : \"0\" + sH) + \":\" + (sM >= 10 ? sM : \"0\" + sM);\n            end_time = (eH >= 10 ? eH : \"0\" + eH) + \":\" + (eM >= 10 ? eM : \"0\" + eM);\n            _context2.next = 37;\n            return _regeneratorRuntime.awrap(Notifications.scheduleNotificationAsync({\n              content: {\n                title: '수업 알림!',\n                body: val + \"\\uBD84 \\uB4A4\\uC5D0 \" + class_list[i].name + \"(\" + class_list[i].room + \") \" + month + \"/\" + date + \" \" + start_time + \"~\" + end_time + \"\\uC218\\uC5C5\\uC774 \\uC788\\uC2B5\\uB2C8\\uB2E4.\",\n                sound: 'default'\n              },\n              trigger: trigger\n            }));\n\n          case 37:\n            id = _context2.sent;\n\n          case 38:\n            i++;\n            _context2.next = 23;\n            break;\n\n          case 41:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  return React.createElement(View, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 7\n    }\n  }, React.createElement(View, {\n    style: styles.card,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 11\n    }\n  }, React.createElement(View, {\n    style: styles.item,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 15\n    }\n  }, React.createElement(Text, {\n    style: styles.title,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 17\n    }\n  }, \"\\uACC4\\uC815: \", user.email)), React.createElement(View, {\n    style: styles.item,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 15\n    }\n  }, React.createElement(Text, {\n    style: styles.title,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 17\n    }\n  }, \"\\uB4F1\\uAE09: \", user_meta.grade)), React.createElement(View, {\n    style: styles.item,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 15\n    }\n  }, React.createElement(Text, {\n    style: styles.title,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 17\n    }\n  }, \"\\uD478\\uC26C \\uC54C\\uB9BC \\uC124\\uC815\"), React.createElement(TouchableOpacity, {\n    style: {\n      marginVertical: 5\n    },\n    onPress: function onPress() {\n      return user_meta.grade > 1 ? Alert.alert(\"학생회비 납부자 전용 기능입니다\") : null;\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 17\n    }\n  }, pushInit != null ? React.createElement(SwitchSelector, {\n    disabled: user_meta.grade > 1 ? true : false,\n    options: options,\n    initial: pushInit,\n    backgroundColor: \"#eeeeee\",\n    buttonColor: \"#1478FF\",\n    fontSize: 15,\n    onPress: function onPress(val) {\n      if (user_meta.grade < 2) {\n        setNotification(val);\n      } else {\n        Alert.alert(\"학생회비 납부자 전용 기능입니다\");\n        return 0;\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 21\n    }\n  }) : null)), React.createElement(View, {\n    style: styles.item,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 15\n    }\n  }, React.createElement(View, {\n    style: {\n      flexDirection: \"row\",\n      justifyContent: \"space-between\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 17\n    }\n  }, React.createElement(Text, {\n    style: styles.title,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 19\n    }\n  }, \"\\uACF5\\uC9C0 \\uC54C\\uB9BC \\uC124\\uC815\"), React.createElement(View, {\n    style: {\n      justifyContent: \"flex-end\",\n      marginBottom: 5\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 19\n    }\n  }, React.createElement(Switch, {\n    value: notif_switch,\n    onValueChange: function onValueChange() {\n      return notif_switch_handler();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 21\n    }\n  }))))), React.createElement(View, {\n    style: {\n      alignItems: \"center\",\n      justifyContent: \"center\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 11\n    }\n  }, React.createElement(TouchableOpacity, {\n    style: styles.button,\n    onPress: function onPress() {\n      return exportICS();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 15\n    }\n  }, React.createElement(Text, {\n    style: {\n      fontSize: 20,\n      color: \"white\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 17\n    }\n  }, \"\\uC77C\\uC815 \\uB0B4\\uBCF4\\uB0B4\\uAE30\")), React.createElement(TouchableOpacity, {\n    style: styles.button,\n    onPress: function onPress() {\n      return signOut();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 15\n    }\n  }, React.createElement(Text, {\n    style: {\n      fontSize: 20,\n      color: \"white\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 17\n    }\n  }, \"\\uB85C\\uADF8\\uC544\\uC6C3\"))));\n}\n\nfunction Main() {\n  var _useQuery = useQuery(SEE_REGIST_LECTURE),\n      loading = _useQuery.loading,\n      error = _useQuery.error,\n      data = _useQuery.data;\n\n  if (loading) {\n    console.log(\"loading...\");\n    return React.createElement(View, {\n      style: {\n        flex: 1,\n        justifyContent: 'center',\n        alignItems: 'center'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 7\n      }\n    }, React.createElement(ActivityIndicator, {\n      size: \"large\",\n      color: \"#1478FF\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 9\n      }\n    }));\n  }\n\n  if (data) {\n    var lectures = data.seeRegistLecture;\n    console.log(\"length: \", lectures.length);\n    var class_list = [];\n\n    for (var i = 0; i < lectures.length; i++) {\n      var num_of_classes = lectures[i].classes.length;\n\n      for (var j = 0; j < num_of_classes; j++) {\n        if (lectures[i].classes[j].VOD) continue;\n        var start_time = new Date(Number(lectures[i].classes[j].startTime) + TIMEZONE);\n        var end_time = new Date(Number(lectures[i].classes[j].endTime) + TIMEZONE);\n        var class_obj = {\n          name: lectures[i].name,\n          room: lectures[i].room,\n          start_time: start_time,\n          end_time: end_time,\n          week: lectures[i].classes[j].week,\n          vod: lectures[i].classes[j].VOD\n        };\n        class_list.push(class_obj);\n      }\n    }\n\n    class_list.sort(function (a, b) {\n      return a.start_time.getTime() - b.start_time.getTime();\n    });\n    return React.createElement(Sub, {\n      class_list: class_list,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 277,\n        columnNumber: 7\n      }\n    });\n  }\n}\n\nexport default function AccountScreen() {\n  var userInfo = React.useContext(UserContext);\n  var client = new ApolloClient({\n    uri: \"http://52.251.50.212:4000/\",\n    cache: new InMemoryCache(),\n    headers: {\n      Authorization: \"Bearer \" + userInfo.token\n    }\n  });\n  return React.createElement(ApolloProvider, {\n    client: client,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 305,\n      columnNumber: 5\n    }\n  }, React.createElement(Main, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 7\n    }\n  }));\n}\nvar styles = StyleSheet.create({\n  classboxText: {\n    textAlign: \"center\",\n    fontSize: 11\n  },\n  classboxTextsmall: {\n    textAlign: \"center\",\n    fontSize: 6\n  },\n  classbox: {\n    paddingVertical: 3,\n    justifyContent: \"center\",\n    borderStyle: \"dashed\",\n    borderWidth: 1,\n    flex: 1\n  },\n  classbox2: {\n    justifyContent: \"center\",\n    borderStyle: \"dashed\",\n    borderWidth: 1,\n    flex: 1\n  },\n  weeklyHeader: {\n    backgroundColor: \"white\",\n    flexDirection: 'row',\n    borderStyle: \"dashed\",\n    borderWidth: 1\n  },\n  weeklyHeaderBox: {\n    padding: 9,\n    flex: 1\n  },\n  weeklyHeaderText: {\n    textAlign: \"center\",\n    fontWeight: \"700\"\n  },\n  scrollView: {\n    height: 200\n  },\n  card2: {\n    marginVertical: 5,\n    marginHorizontal: 25,\n    borderWidth: 1,\n    borderColor: \"#dcdcdc\",\n    borderRadius: 10,\n    height: \"40%\"\n  },\n  card: {\n    backgroundColor: \"white\",\n    marginVertical: 25,\n    marginHorizontal: 25,\n    borderWidth: 1,\n    borderColor: \"#dcdcdc\",\n    borderRadius: 10,\n    padding: 10\n  },\n  date: {\n    margin: 5,\n    color: \"blue\",\n    fontSize: 15,\n    borderColor: \"black\",\n    textAlign: \"center\"\n  },\n  time: {\n    margin: 5,\n    fontWeight: \"600\",\n    fontSize: 20,\n    textAlign: \"center\"\n  },\n  title: {\n    fontSize: 17,\n    fontWeight: \"600\"\n  },\n  location: {\n    textAlign: \"center\",\n    fontSize: 10,\n    color: \"#646464\"\n  },\n  week: {\n    margin: 5,\n    textAlign: \"center\",\n    fontSize: 10,\n    color: \"#646464\"\n  },\n  where: {\n    marginTop: 7,\n    padding: 3,\n    borderRadius: 10,\n    backgroundColor: \"#dcdcdc\",\n    alignSelf: \"center\",\n    fontSize: 10,\n    color: \"grey\"\n  },\n  container: {\n    flex: 1,\n    backgroundColor: '#fff',\n    alignItems: 'center'\n  },\n  button: {\n    alignItems: 'center',\n    marginVertical: 10,\n    marginHorizontal: 10,\n    borderWidth: 1,\n    padding: 10,\n    width: \"80%\",\n    borderRadius: 10,\n    backgroundColor: \"#1478FF\",\n    borderColor: \"white\"\n  },\n  item: {\n    marginVertical: 10,\n    marginHorizontal: 10,\n    borderBottomWidth: 1,\n    borderBottomColor: \"#eeeeee\"\n  }\n});","map":{"version":3,"sources":["C:/Users/heejun/test0220/screens/AccountScreen.js"],"names":["React","AuthContext","UserContext","IdContext","SwitchSelector","SEE_REGIST_LECTURE","ApolloClient","InMemoryCache","useQuery","ApolloProvider","FileSystem","Sharing","Notifications","AsyncStorage","ICSname","NOW","Date","TIMEZONE","getTimezoneOffset","options","label","value","convertToICSDate","dateTime","year","getFullYear","toString","month","getMonth","day","getDate","hours","getHours","minutes","getMinutes","createVEVENT","start","end","summary","description","location","createCAL","class_list","template","i","length","start_time","end_time","name","room","Sub","user","useContext","user_meta","signOut","useState","notif_switch","setNotifSwitch","console","log","getItem","err","res","notif_switch_handler","setItem","exportICS","uri","documentDirectory","file","writeAsStringAsync","then","shareAsync","catch","error","pushInit","setPushInit","Number","setNotification","val","initIndex","cancelAllScheduledNotificationsAsync","trigger","getTime","date","sH","sM","eH","eM","scheduleNotificationAsync","content","title","body","sound","id","styles","card","item","email","grade","marginVertical","Alert","alert","flexDirection","justifyContent","marginBottom","alignItems","button","fontSize","color","Main","loading","data","flex","lectures","seeRegistLecture","num_of_classes","classes","j","VOD","startTime","endTime","class_obj","week","vod","push","sort","a","b","AccountScreen","userInfo","client","cache","headers","Authorization","token","StyleSheet","create","classboxText","textAlign","classboxTextsmall","classbox","paddingVertical","borderStyle","borderWidth","classbox2","weeklyHeader","backgroundColor","weeklyHeaderBox","padding","weeklyHeaderText","fontWeight","scrollView","height","card2","marginHorizontal","borderColor","borderRadius","margin","time","where","marginTop","alignSelf","container","width","borderBottomWidth","borderBottomColor"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { AuthContext, UserContext, IdContext} from '../components/context';\r\nimport {View, Text, TouchableOpacity, StyleSheet, ActivityIndicator, Alert, Switch } from 'react-native';\r\nimport SwitchSelector from 'react-native-switch-selector';\r\nimport { SEE_REGIST_LECTURE } from '../queries';\r\nimport { ApolloClient, InMemoryCache, useQuery, ApolloProvider } from \"@apollo/client\";\r\nimport * as FileSystem from 'expo-file-system';\r\nimport * as Sharing from 'expo-sharing';\r\n\r\nimport * as Notifications from 'expo-notifications';\r\nimport AsyncStorage from '@react-native-community/async-storage';\r\n\r\nconst ICSname = \"학교생활도우미 일정\";               // 내보내기 할때 사용할 캘린더 이름             \r\nconst NOW = new Date();                         // 현재 시간\r\nconst TIMEZONE = NOW.getTimezoneOffset()*60000; // DB와 타임존 싱크를 맞추기 위한 상수 \r\n\r\nconst options = [                               // \"수업 n분 전 알림\"을 위한 옵션\r\n  { label: '끄기', value: 0},\r\n  { label: '5분', value: 5 },\r\n  { label: '10분', value: 10 },\r\n  { label: '15분', value: 15 },\r\n  { label: '20분', value: 20 },\r\n  { label: '30분', value: 30 },\r\n  { label: '60분', value: 60 },\r\n];\r\n\r\n// 자바스크립트의 Date를 받아서 ICS Date 형식으로 바꾸어 리턴\r\nfunction convertToICSDate(dateTime) {\r\n    const year = dateTime.getFullYear().toString();\r\n    const month = (dateTime.getMonth() + 1) < 10 ? \"0\" + (dateTime.getMonth() + 1).toString() : (dateTime.getMonth() + 1).toString();\r\n    const day = dateTime.getDate() < 10 ? \"0\" + dateTime.getDate().toString() : dateTime.getDate().toString();\r\n    const hours = dateTime.getHours() < 10 ? \"0\" + dateTime.getHours().toString() : dateTime.getHours().toString();\r\n    const minutes = dateTime.getMinutes() < 10 ? \"0\" +dateTime.getMinutes().toString() : dateTime.getMinutes().toString();\r\n\r\n    return year + month + day + \"T\" + hours + minutes + \"00Z\";\r\n}\r\n\r\n// 시작,끝 시간을 받아서 하나의 ICS이벤트 형식으로 포매팅하여 리턴 \r\nfunction createVEVENT(start, end, summary=\"\", description=\"\", location=\"\"){\r\n    return `BEGIN:VEVENT\r\nDTSTART:${convertToICSDate(start)}\r\nDTEND:${convertToICSDate(end)}\r\nDESCRIPTION:${description}\r\nLOCATION:${location}\r\nSUMMARY:${summary}\r\nEND:VEVENT\r\n`\r\n}\r\n\r\n// 수업 리스트를 받아서 각 수업마다 VEVENT(ICS 이벤트) 형식을 포매팅한 후 이어붙인다.\r\nfunction createCAL(class_list){\r\n  let template = `BEGIN:VCALENDAR\r\nPRODID:-//Google Inc//Google Calendar 70.9054//EN\r\nVERSION:2.0\r\nCALSCALE:GREGORIAN\r\nMETHOD:PUBLISH\r\nX-WR-CALNAME:${ICSname}\r\nX-WR-TIMEZONE:Asia/Seoul\r\nBEGIN:VTIMEZONE\r\nTZID:Asia/Seoul\r\nX-LIC-LOCATION:Asia/Seoul\r\nBEGIN:STANDARD\r\nTZOFFSETFROM:+0900\r\nTZOFFSETTO:+0900\r\nTZNAME:KST\r\nDTSTART:19700101T000000\r\nEND:STANDARD\r\nEND:VTIMEZONE\r\n`;\r\n  for(let i=0; i<class_list.length; i++){\r\n    template += createVEVENT(class_list[i].start_time, \r\n                             class_list[i].end_time, \r\n                             class_list[i].name, \r\n                             class_list[i].name,\r\n                             class_list[i].room);\r\n  }\r\n  template += \"END:VCALENDAR\"\r\n  return template;\r\n}\r\n\r\n\r\n\r\n\r\n\r\nfunction Sub({class_list}){\r\n  const user = React.useContext(UserContext);\r\n  const user_meta = React.useContext(IdContext);\r\n  const { signOut } = React.useContext(AuthContext);\r\n\r\n  // 공지 알림 ON/OFF\r\n  const [notif_switch, setNotifSwitch] = React.useState(true);\r\n  console.log(\"notif_switch:\", notif_switch);\r\n    // 공지 알림 ON/OFF 초기값 세팅\r\n  AsyncStorage.getItem(\"notif_switch\",(err,res)=>{\r\n    console.log(\"notif_switch res:\", res);\r\n    res==\"ON\"? setNotifSwitch(true):setNotifSwitch(false);\r\n  });\r\n\r\n  const notif_switch_handler = async()=>{\r\n    if(notif_switch){ // 끄는 상황\r\n      await AsyncStorage.setItem(\"notif_switch\", \"OFF\");\r\n    }\r\n    else{\r\n      await AsyncStorage.setItem(\"notif_switch\", \"ON\");\r\n    }\r\n    setNotifSwitch(!notif_switch);\r\n  }\r\n  const exportICS = ()=>{\r\n    let uri = FileSystem.documentDirectory + \"schedule.ics\"\r\n    let file = createCAL(class_list);\r\n    FileSystem.writeAsStringAsync(uri, file).then(()=>{\r\n      Sharing.shareAsync(uri);\r\n    }).catch(error=>{\r\n      console.log(error);\r\n    })\r\n  }\r\n\r\n\r\n  // 푸쉬 알림 설정 코드\r\n  const [pushInit, setPushInit] = React.useState(null);\r\n  AsyncStorage.getItem(\"pushInitIndex\", (err,res)=>{\r\n    console.log(\"pushInitIndex res:\", res);\r\n    setPushInit(Number(res));\r\n  })\r\n  \r\n  const setNotification = async (val) =>{\r\n    console.log(\"setNotification()\");\r\n    let initIndex = \"0\";\r\n    switch(val){\r\n      case 5: initIndex=\"1\"; break;\r\n      case 10: initIndex=\"2\"; break;\r\n      case 15: initIndex=\"3\"; break;\r\n      case 20: initIndex=\"4\"; break;\r\n      case 30: initIndex=\"5\"; break;\r\n      case 60: initIndex=\"6\"; break;\r\n      default: initIndex=\"0\";\r\n    }\r\n    AsyncStorage.setItem(\"pushInitIndex\", initIndex, ()=>{console.log(`pushInitIndex set: ${initIndex}`)})\r\n    await Notifications.cancelAllScheduledNotificationsAsync();\r\n    if (val>0){\r\n      for(let i=0; i<class_list.length; i++){\r\n        if(class_list[i].start_time < NOW) continue;\r\n\r\n        let trigger = new Date(class_list[i].start_time.getTime() - val*60*1000);\r\n\r\n        let month = class_list[i].start_time.getMonth()+1;\r\n        let date = class_list[i].start_time.getDate();\r\n        let sH = class_list[i].start_time.getHours();\r\n        let sM = class_list[i].start_time.getMinutes();\r\n        let eH = class_list[i].end_time.getHours();\r\n        let eM = class_list[i].end_time.getMinutes();\r\n        let start_time= `${sH>=10?sH:`0${sH}`}:${sM>=10?sM:`0${sM}`}`;\r\n        let end_time= `${eH>=10?eH:`0${eH}`}:${eM>=10?eM:`0${eM}`}`;\r\n        let id = await Notifications.scheduleNotificationAsync({\r\n          content:{\r\n            title: '수업 알림!',\r\n            body: `${val}분 뒤에 ${class_list[i].name}(${class_list[i].room}) ${month}/${date} ${start_time}~${end_time}수업이 있습니다.`,\r\n            sound: 'default'\r\n          },\r\n          trigger,\r\n        })\r\n      }\r\n    }\r\n  }\r\n\r\n  return(\r\n      <View>\r\n          <View style={styles.card}>\r\n              <View style={styles.item}>\r\n                <Text style={styles.title}>계정: {user.email}</Text>\r\n              </View>\r\n              <View style={styles.item}> \r\n                <Text style={styles.title}>등급: {user_meta.grade}</Text>\r\n              </View>\r\n              <View style={styles.item}>\r\n                <Text style={styles.title}>푸쉬 알림 설정</Text> \r\n                <TouchableOpacity style={{marginVertical: 5}} onPress={()=>user_meta.grade>1?Alert.alert(\"학생회비 납부자 전용 기능입니다\"):null}>\r\n                  {\r\n                    pushInit != null? \r\n                    <SwitchSelector \r\n                      disabled={user_meta.grade>1?true:false}\r\n                      options={options} \r\n                      initial={pushInit}\r\n                      backgroundColor=\"#eeeeee\"\r\n                      buttonColor=\"#1478FF\"\r\n                      fontSize={15}\r\n                      onPress={val=>{\r\n                        if(user_meta.grade<2){\r\n                          setNotification(val)                         \r\n                        }\r\n                        else{\r\n                          Alert.alert(\"학생회비 납부자 전용 기능입니다\")\r\n                          return 0;\r\n                        }\r\n                      }\r\n                      }  \r\n                    />\r\n                    :\r\n                    null\r\n                  }\r\n                </TouchableOpacity>\r\n              </View>\r\n              {\r\n              <View style={styles.item}>\r\n                <View style={{flexDirection:\"row\", justifyContent:\"space-between\"}}>\r\n                  <Text style={styles.title}>공지 알림 설정</Text>\r\n                  <View style={{justifyContent:\"flex-end\", marginBottom:5}}>\r\n                    <Switch \r\n                      value={notif_switch}\r\n                      onValueChange={()=>notif_switch_handler()}\r\n                    />\r\n                  </View>  \r\n                </View>\r\n\r\n              </View>\r\n              }   \r\n          </View>\r\n          <View style={{alignItems:\"center\", justifyContent:\"center\"}}>\r\n              <TouchableOpacity style={styles.button} onPress={()=>exportICS()}>\r\n                <Text style={{fontSize:20, color:\"white\"}}>일정 내보내기</Text>\r\n              </TouchableOpacity>\r\n              <TouchableOpacity style={styles.button} onPress={()=>signOut()}>\r\n                <Text style={{fontSize:20, color:\"white\"}}>로그아웃</Text>\r\n              </TouchableOpacity>\r\n          </View>\r\n\r\n      </View>\r\n    \r\n  )\r\n}\r\n\r\n\r\n\r\nfunction Main(){\r\n  const { loading, error, data } = useQuery(SEE_REGIST_LECTURE);\r\n\r\n  //console.log(\"loading: \",loading);\r\n  //console.log(\"data   : \" , data);\r\n  //console.log(\"error  : \", error );\r\n\r\n  if(loading){\r\n    console.log(\"loading...\");\r\n    return (\r\n      <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>\r\n        <ActivityIndicator size=\"large\" color=\"#1478FF\"/>\r\n      </View>\r\n    )    \r\n  }\r\n  if(data){\r\n    // 데이터 전처리. \r\n    let lectures = data.seeRegistLecture;\r\n    console.log(\"length: \", lectures.length);\r\n    let class_list = [];\r\n    for(let i=0; i<lectures.length; i++){\r\n      let num_of_classes = lectures[i].classes.length;\r\n      for(let j=0; j<num_of_classes; j++){\r\n        if (lectures[i].classes[j].VOD) continue;\r\n        let start_time = new Date(Number(lectures[i].classes[j].startTime)+TIMEZONE);\r\n        let end_time = new Date(Number(lectures[i].classes[j].endTime)+TIMEZONE);\r\n        let class_obj = {\r\n          name: lectures[i].name,\r\n          room: lectures[i].room,\r\n          start_time: start_time,\r\n          end_time: end_time,\r\n          week: lectures[i].classes[j].week,\r\n          vod: lectures[i].classes[j].VOD\r\n        }\r\n        class_list.push(class_obj);\r\n      }\r\n    }\r\n    // 수업을 빠른 시간순으로 정렬 \r\n    class_list.sort((a,b)=>{\r\n      return a.start_time.getTime() - b.start_time.getTime();\r\n    })\r\n    //console.log(class_list);\r\n    return (\r\n      <Sub class_list = {class_list} />\r\n    );\r\n  }\r\n}\r\n\r\nexport default function AccountScreen(){\r\n  const userInfo = React.useContext(UserContext);\r\n  const client = new ApolloClient({\r\n    uri: \"http://52.251.50.212:4000/\",\r\n    cache: new InMemoryCache(),\r\n    headers: {\r\n      Authorization: `Bearer ${userInfo.token}`\r\n    }\r\n  });\r\n/*\r\n  FileSystem.downloadAsync(\r\n    'http://techslides.com/demos/sample-videos/small.mp4',\r\n    FileSystem.documentDirectory + 'small.mp4'\r\n  )\r\n    .then(({ uri }) => {\r\n      console.log('Finished downloading to ', uri);\r\n      Sharing.shareAsync(uri);\r\n    })\r\n    .catch(error => {\r\n      console.error(error);\r\n    });\r\n*/\r\n  return (\r\n    <ApolloProvider client={client}>\r\n      <Main/>\r\n    </ApolloProvider>\r\n  )\r\n}\r\n  \r\n\r\n  const styles = StyleSheet.create({\r\n    classboxText:{\r\n      textAlign: \"center\",\r\n      fontSize: 11,\r\n    },\r\n    classboxTextsmall:{\r\n      textAlign: \"center\",\r\n      fontSize: 6,\r\n    },\r\n    classbox:{\r\n      paddingVertical: 3,\r\n      justifyContent: \"center\",\r\n      borderStyle: \"dashed\",\r\n      borderWidth: 1,\r\n      flex: 1\r\n    },\r\n    classbox2:{\r\n      justifyContent: \"center\",\r\n      borderStyle: \"dashed\",\r\n      borderWidth: 1,\r\n      flex: 1\r\n    },\r\n    weeklyHeader: {\r\n      backgroundColor: \"white\",\r\n      flexDirection: 'row',\r\n      borderStyle: \"dashed\",\r\n      borderWidth: 1,\r\n    },\r\n    weeklyHeaderBox: {\r\n      padding: 9,\r\n      flex: 1\r\n    },\r\n    weeklyHeaderText: {\r\n      textAlign: \"center\",\r\n      fontWeight: \"700\"\r\n    },\r\n    scrollView: {\r\n      height: 200\r\n    },\r\n    card2: {\r\n      marginVertical: 5,\r\n      marginHorizontal: 25,\r\n      borderWidth: 1,\r\n      borderColor: \"#dcdcdc\",\r\n      borderRadius: 10,\r\n      height: \"40%\"\r\n    },\r\n    card: {\r\n      backgroundColor: \"white\",\r\n      marginVertical: 25,\r\n      marginHorizontal: 25,\r\n      borderWidth: 1,\r\n      borderColor: \"#dcdcdc\",\r\n      borderRadius: 10,\r\n      padding: 10\r\n    },\r\n    date: {\r\n      margin: 5,\r\n      color: \"blue\",\r\n      fontSize: 15,\r\n      borderColor: \"black\",\r\n      textAlign: \"center\",\r\n    },\r\n    time: {\r\n      margin: 5,\r\n      fontWeight: \"600\",\r\n      fontSize: 20,\r\n      textAlign: \"center\",\r\n    },\r\n    title: {\r\n      fontSize: 17,\r\n      fontWeight: \"600\",\r\n    },\r\n    location: {\r\n      textAlign: \"center\",\r\n      fontSize: 10,\r\n      color: \"#646464\",\r\n    },\r\n    week: {\r\n      margin: 5,\r\n      textAlign: \"center\",\r\n      fontSize: 10,\r\n      color: \"#646464\",\r\n    },\r\n    where: {\r\n      marginTop: 7,\r\n      padding: 3,\r\n      borderRadius: 10,\r\n      backgroundColor: \"#dcdcdc\",\r\n      alignSelf: \"center\",\r\n      fontSize: 10,\r\n      color: \"grey\",\r\n    },\r\n    container: {\r\n      flex: 1,\r\n      backgroundColor: '#fff',\r\n      alignItems: 'center',\r\n    },\r\n    button: {\r\n      alignItems: 'center',\r\n      marginVertical: 10,\r\n      marginHorizontal: 10,\r\n      borderWidth:1,\r\n      padding:10,\r\n      width: \"80%\",\r\n      borderRadius: 10,\r\n      backgroundColor: \"#1478FF\",\r\n      borderColor: \"white\"\r\n  },\r\n    item:{\r\n      marginVertical: 10,\r\n      marginHorizontal: 10,\r\n      borderBottomWidth: 1,\r\n      borderBottomColor: \"#eeeeee\",\r\n    }\r\n  });"]},"metadata":{},"sourceType":"module"}